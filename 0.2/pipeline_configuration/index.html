<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Global Pipeline Configuration Settings - Meta-Omics-Toolkit</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <link href="../css/version-select.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Meta-Omics-Toolkit</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Global Pipeline Configuration Settings</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../modules/qualityControl/" class="dropdown-item">Quality Control</a>
</li>
                                    
<li>
    <a href="../modules/annotation/" class="dropdown-item">Annotation</a>
</li>
                                    
<li>
    <a href="../modules/assembly/" class="dropdown-item">Assembly</a>
</li>
                                    
<li>
    <a href="../modules/cooccurrence/" class="dropdown-item">Cooccurrence</a>
</li>
                                    
<li>
    <a href="../modules/dereplication/" class="dropdown-item">Dereplication</a>
</li>
                                    
<li>
    <a href="../modules/fragment_recruitment/" class="dropdown-item">Run Fragment Recruitment</a>
</li>
                                    
<li>
    <a href="../modules/magAttributes/" class="dropdown-item">MagAttributes</a>
</li>
                                    
<li>
    <a href="../modules/plasmids/" class="dropdown-item">Plasmids</a>
</li>
                                    
<li>
    <a href="../modules/metabolomics/" class="dropdown-item">Metabolomics</a>
</li>
                                    
<li>
    <a href="../modules/readMapping/" class="dropdown-item">Read Mapping</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Developer <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../developer_guidelines/" class="dropdown-item">Guidelines</a>
</li>
                                    
<li>
    <a href="../pipeline_specification/" class="dropdown-item">Pipeline Specification</a>
</li>
                                    
<li>
    <a href="../module_specification/" class="dropdown-item">Module Specification</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../modules/qualityControl/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#global-parameter-settings" class="nav-link">Global parameter settings</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#s3-configuration" class="nav-link">S3 Configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#configuration-of-input-parameters-of-the-full-pipeline-mode" class="nav-link">Configuration of input parameters of the full pipeline mode</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#database-input-configuration" class="nav-link">Database input configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#optional-configuration-of-computational-resources-used-for-pipeline-runs" class="nav-link">Optional configuration of computational resources used for pipeline runs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#fragment-recruitment-for-unmapped-reads-configuration" class="nav-link">Fragment Recruitment for unmapped reads Configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="global-parameter-settings">Global parameter settings</h1>
<ul>
<li>
<p><code>tempdir</code>: Temporary directory for storing files that are used to collect intermediate files.</p>
</li>
<li>
<p><code>summary</code>: If true a summary folder is created storing results of all samples combined.</p>
</li>
<li>
<p><code>output</code>: Output directory for storing pipeline results. If an S3 bucket is specified with the corresponding S3 credentials (See S3 configuration section) then
   the output is written to S3.</p>
</li>
<li>
<p><code>runid</code>: The run ID will be part of the output path and allows to distinguish between different pipeline configurations that were used for the same dataset.</p>
</li>
<li>
<p><code>logDir</code>: A path to a directory which is used to store log files.</p>
</li>
<li>
<p><code>scratch</code>: The scratch value can be either <code>false</code> or a path on a worker node. If a path is set, then the nextflow process in <code>slurm</code> mode is executed on the provided path.
    If the standard mode is used, then the parameter is ignored.</p>
</li>
<li>
<p><code>steps</code>: Steps allows to specify multiple pipeline modules for running the toolkit. We distinguish between two modes. You can either run one tool of
   the pipeline or the whole pipeline with different configurations.</p>
</li>
<li>
<p><code>databases</code>: This parameter specifies a place where files are downloaded to. If the <code>slurm</code> profile is used and databases should be downloaded, the path <strong>should</strong> point to a folder 
    which is not shared between the worker nodes (to reduce I/O on the shared folder resulting in a better performance). If this parameter is provided, the toolkit will create the specified
    directory. If all your databases have already been extracted beforehand, you can simply omit this parameter.</p>
</li>
<li>
<p><code>publishDirMode</code>: (optional) Per default results are symlinked to the chosen <code>output</code> directory. This default mode can be changed with this parameter.
    A useful mode is "copy", to copy results instead of just linking them. Other modes to choose from <a href="https://www.nextflow.io/docs/latest/process.html#publishdir">here</a>.  </p>
</li>
<li>
<p><code>skipVersionCheck</code>: The toolkit is regurarly tested against a set of Nextflow versions. Setting the <code>--skipVersionCheck</code> allows you to use the toolkit with Nextflow versions
   that were not tested.</p>
</li>
<li>
<p><code>s3SignIn</code>: If your input data (not the databases) is not publicly accessible via S3, then you will have to set the <code>s3SignIn</code> parameter to <code>true</code>.</p>
</li>
</ul>
<h2 id="s3-configuration">S3 Configuration</h2>
<p>All module inputs and outputs can be used in conjunction with S3.
If you want to set a custom S3 configuration setting (i.e. custom S3 endpoint), you will have to modify the aws client parameters 
with " -c ".</p>
<p>Example:
<div class="highlight"><pre><span></span><code>aws {
    client {
      s_3_path_style_access = true
      maxParallelTransfers = 28 
      maxErrorRetry = 10
      protocol = &#39;HTTPS&#39;
      endpoint = &#39;https://openstack.cebitec.uni-bielefeld.de:8080&#39;
      signerOverride = &#39;AWSS3V4SignerType&#39;
    }
}
</code></pre></div></p>
<p>In addition you will have to set a Nextflow Secret with the following keys:</p>
<div class="highlight"><pre><span></span><code>nextflow secrets set S3_ACCESS xxxxxxxxx
nextflow secrets set S3_SECRET xxxxxxxxx
</code></pre></div>
<p><code>S3_ACCESS</code> corresponds to the aws S3 access key id and <code>S3_SECRET</code> is the aws S3 secret key.
If your input data (not the databases) is publicly available then you have to set <code>s3SignIn:</code> to <code>false</code> in your config file.
Please note that for using databases you have to provide an additional aws credentials file (see database section). </p>
<h2 id="configuration-of-input-parameters-of-the-full-pipeline-mode">Configuration of input parameters of the full pipeline mode</h2>
<h3 id="paired-end-input">Paired End Input</h3>
<p>The input should be a path to a tsv file containing a sample id, as well as a path to the left and right read.</p>
<p>Example:
<div class="highlight"><pre><span></span><code>input:
  paired:
    path: &quot;test_data/fullPipeline/reads_split.tsv&quot;
</code></pre></div></p>
<h3 id="nanopore-input">Nanopore Input</h3>
<p>For Nanopore data a seperate input file should be specified.</p>
<div class="highlight"><pre><span></span><code>input:
  ont:
    path: &quot;test_data/fullPipeline/ont.tsv&quot;
</code></pre></div>
<h3 id="generic-sra">Generic SRA</h3>
<p>The toolkit is able to fetch fastq files based on SRA run accession ids from the NCBI or from a mirror based on S3:</p>
<div class="highlight"><pre><span></span><code>input:
  SRA:
    pattern:
      ont: &quot;.+[^(_1|_2)].+$&quot;
      illumina: &quot;.+(_1|_2).+$&quot;
    S3:
      path: test_data/SRA/samples.tsv 
      bucket: &quot;s3://ftp.era.ebi.ac.uk&quot; 
      prefix: &quot;/vol1/fastq/&quot;
      watch: false
      patternONT: &quot;.+[^(_1|_2)].+$&quot;
      patternIllumina: &quot;.+(_1|_2).+$&quot;
</code></pre></div>
<p>where:
  * <code>path</code> is the path to a file containing a column with <code>ACCESSION</code> as header. The <code>ACCESSION</code> column contains either SRA run or study accessions.</p>
<ul>
<li>
<p><code>bucket</code> is the S3 Bucket hosting the data.</p>
</li>
<li>
<p><code>prefix</code> is the path to the actual SRA datasets.</p>
</li>
<li>
<p><code>watch</code> if true, the file specified with the <code>path</code> attribute is watched and every time a new SRA run id is
     appended, the pipeline is triggered. The pipeline will never finish in this mode. Please note that watch currently only works
     if only one input type is specified (e.g "ont" or "paired" ...)</p>
</li>
<li>
<p><code>patternONT</code> and <code>patternIllumina</code> are patterns that are applied on the specified mirror in order to select the correct input files.</p>
</li>
</ul>
<h3 id="ncbi-sra">NCBI SRA</h3>
<p>With the following mode SRA datasets can directly be fetched from SRA.</p>
<div class="highlight"><pre><span></span><code>input:
  SRA:
    pattern:
      ont: &quot;.+[^(_1|_2)].+$&quot;
      illumina: &quot;.+(_1|_2).+$&quot;
    NCBI:
      path: test_data/SRA/samples.tsv
</code></pre></div>
<h2 id="database-input-configuration">Database input configuration</h2>
<p>Whenever a database field can be specified as part of the tool configuration (such as in gtdb or checkm), you are able to provide different methods to
fetch the database. In all settings, please make sure that the file has the same ending (e.g. .zip, .tar.gz) as specified in the corresponding tool section.
In addition, as database names are used to name results with which they were created, said database names should contain the respective database number or date of creation.
With this every result can be linked to one exact database version to clarify results. 
Except for the <code>extractedDBPath</code> parameter, all other input types (https, s3,...) will download the database to the folder specified in the <code>database</code> parameter.</p>
<h3 id="extracted-database-path">Extracted Database Path</h3>
<p>If you have already downloaded and extracted the database, you can specify the path using the <code>extractedDBPath</code> parameter.
This setting is available in standard and slurm mode. In slurm mode the path can point to a db on the worker node.</p>
<p>Example:
<div class="highlight"><pre><span></span><code>database:
  extractedDBPath: /vol/spool/gtdb/release202
</code></pre></div></p>
<h3 id="https-download">HTTPS Download</h3>
<p>The toolkit is able to download and extract the database, as long as the file ending equals the one specified in the corresponding tool section (.zip, tar.gz, tar.zst)
This setting is available in standard and slurm mode. </p>
<p>Example:
<div class="highlight"><pre><span></span><code>database:
  download:
    source: &#39;https://openstack.cebitec.uni-bielefeld.de:8080/databases/gtdb.tar.gz&#39;
    md5sum: 77180f6a02769e7eec6b8c22d3614d2e 
</code></pre></div></p>
<h3 id="local-file-path">Local File Path</h3>
<p>This setting allows you to reuse an already downloaded database. </p>
<p>Example:
<div class="highlight"><pre><span></span><code>database:
  download:
    source: &#39;/vol/spool/gtdb.tar.gz&#39;
    md5sum: 77180f6a02769e7eec6b8c22d3614d2e 
</code></pre></div></p>
<h3 id="s3-download">S3 Download</h3>
<p>You can specify an S3 link and configure the S3 call via the <code>s5cmd.params parameter.
The</code>s5cmd.params` parameter allows you to set any setting available of the <a href="https://github.com/peak/s5cmd">s5cmd</a> commandline tool. 
If you need credentials to access your databases, you can set them via the Nextflow secrets mechanism. The correct key name for the access and secret key can be found in the corresponding database section.</p>
<p>In the following example the compressed file will be downloaded and extracted.</p>
<p>Example for publicly available compressed database:
<div class="highlight"><pre><span></span><code>database:
  download:
    source: &#39;s3://databases/gtdb.tar.gz&#39;
    md5sum: 77180f6a02769e7eec6b8c22d3614d2e 
    s5cmd:
      params: &#39;--retry-count 30 --no-sign-request --no-verify-ssl --endpoint-url https://openstack.cebitec.uni-bielefeld.de:8080&#39;
</code></pre></div></p>
<p>If your database is already extracted and available via S3, you can specify the S3 link using a wildcard as in the next example.</p>
<div class="highlight"><pre><span></span><code>database:
  download:
    source: &#39;s3://databases/gtdb/*&#39;
    md5sum: 77180f6a02769e7eec6b8c22d3614d2e 
    s5cmd:
      params: &#39;--retry-count 30 --no-verify-ssl --endpoint-url https://openstack.cebitec.uni-bielefeld.de:8080&#39;
</code></pre></div>
<h3 id="updating-database-md5sums">Updating Database MD5SUMs</h3>
<p>The md5sum is computed over all md5sums of all files of the extracted database.
If you need to update the md5sum because you updated your database you have to download the database 
and run the following command</p>
<div class="highlight"><pre><span></span><code>find /path/to/db -type f -exec md5sum {} \; | sort | cut -d &#39; &#39; -f 1 | md5sum | cut -d &#39; &#39; -f 1
</code></pre></div>
<h3 id="database-download-strategy">Database Download strategy</h3>
<p>The toolkit allows to download databases on multiple nodes and tries to synchronize the download process between
multiple jobs on a node. However not all possible combinations of profiles and download types are reasonable.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">PROFILE</th>
<th style="text-align: left;">Download to Shared  NFS</th>
<th style="text-align: left;">Download to worker scratch dir</th>
<th style="text-align: left;">Reuse extracted directory</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">STANDARD</td>
<td style="text-align: left;">:material-check:</td>
<td style="text-align: left;">:material-close:</td>
<td style="text-align: left;">:material-check:</td>
</tr>
<tr>
<td style="text-align: left;">SLURM</td>
<td style="text-align: left;">:material-check-all:</td>
<td style="text-align: left;">:material-check:</td>
<td style="text-align: left;">:material-check:  On scratch and nfs dir</td>
</tr>
</tbody>
</table>
<h2 id="optional-configuration-of-computational-resources-used-for-pipeline-runs">Optional configuration of computational resources used for pipeline runs</h2>
<p>The toolkit uses the following machine types (flavors) for running tools. All flavors can be optionally
adjusted by modifying the cpus and memory (in GB) parameters. If for example the largest flavor is not available
in the infrastructure, <code>cpus</code> and <code>memory</code> parameters can be modified to fit the highmemMedium flavor. If larger
flavors are available, it makes especially sense to increase the <code>cpus</code> and <code>memory</code> values of the <code>large</code>
flavor to speed up for example assembly and read mapping.</p>
<p>Example Configuration:</p>
<div class="highlight"><pre><span></span><code>resources:
  highmemLarge:
    cpus: 28
    memory: 230
  highmemMedium:
    cpus: 14
    memory: 113
  large:
    cpus: 28
    memory: 58
  medium:
    cpus: 14
    memory: 29
  small:
    cpus: 7
    memory: 14
  tiny:
    cpus: 1
    memory: 1
</code></pre></div>
<p>Additional flavors can be defined that can be used by methods that dynamically compute resources on tool error (see assembly module section).</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code>resources:
  xlarge:
    cpus: 56
    memory: 512
  highmemLarge:
    cpus: 28
    memory: 230
  highmemMedium:
    cpus: 14
    memory: 113
  large:
    cpus: 28
    memory: 58
  medium:
    cpus: 14
    memory: 29
  small:
    cpus: 7
    memory: 14
  tiny:
    cpus: 1
    memory: 1
</code></pre></div>
<p>The full pipeline mode is able to predict the memory consumption of some assemblers (see assembly module section).</p>
<h2 id="fragment-recruitment-for-unmapped-reads-configuration">Fragment Recruitment for unmapped reads Configuration</h2>
<p>Reads that could not be mapped back to a MAG can be used for fragment recruitment.
A list of genomes can be provided in the fragmentRecruitment part. 
Matched reference genomes are included in all other parts of the remaining pipeline.
Look out for their specific headers to differentiate results based on real assembled genomes and the reference genomes.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>
        <script src="../js/version-select.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
